# 介绍

整数集合（intset）是集合键的底层实现之一，当一个集合只包含整数值元素，并且这个
集合的元素数量不多时，Redis就会使用整数集合作为集合键的底层实现。

整数集合（intset）是Redis用于保存整数值的集合抽象数据结构，它可以保存类型为
int16_t、int32_t或者int64_t的整数值，并且保证集合中不会出现重复元素。

# 数据结构

```c
typedef struct intset {
    uint32_t ending;    // 编码方式
    uint32_t length;    // 集合包含的元素数量
    int8_t contents[];  // 保存元素的数组
} intset;
// contents数组是整数集合的底层实现：整数集合的每个元素都是contents数组的一个数组项（item），各个项在数组中按值的大小从小到大有序地排列，并且数组中不包含任何重复项。
// length属性记录了整数集合包含的元素数量，也即是contents数组的长度。
// 虽然intset结构将contents属性声明为int8_t类型的数组，但实际上contents数组并不保存任何int8_t类型的值，contents数组的真正类型取决于encoding属性的值：
//·如果encoding属性的值为INTSET_ENC_INT16，那么contents就是一个int16_t类型的数组，数组里的每个项都是一个int16_t类型的整数值（最小值为-32768，最大值为32767）。
//·如果encoding属性的值为INTSET_ENC_INT32，那么contents就是一个int32_t类型的数组，数组里的每个项都是一个int32_t类型的整数值（最小值为-2147483648，最大值为2147483647）。
//·如果encoding属性的值为INTSET_ENC_INT64，那么contents就是一个int64_t类型的数组，数组里的每个项都是一个int64_t类型的整数值（最小值为-9223372036854775808，最大值为9223372036854775807）。
```

# 升级

每当我们要将一个新元素添加到整数集合里面，并且新元素的类型比整数集合现有所有
元素的类型都要长时，整数集合需要先进行升级（upgrade），然后才能将新元素添加到整数
集合里面

> 升级整数集合并添加新元素共分为三步进行：
* 根据新元素的类型，扩展整数集合底层数组的空间大小，并为新元素分配空间。
* 将底层数组现有的所有元素都转换成与新元素相同的类型，并将类型转换后的元素
放置到正确的位上，而且在放置元素的过程中，需要继续维持底层数组的有序性质不变。
* 将新元素添加到底层数组里面。

# 降级

整数集合不支持降级操作，一旦对数组进行了升级，编码就会一直保持升级后的状态。